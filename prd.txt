标书全能王 技术实现 PRD（精简版）：标书智能审查 + 可视化扫描
1. 目标
对用户上传的标书 PDF 进行自动审查，输出：
122. 差错清单（r0001/r0002/r0003），条目可点击定位证据页
123. 标书检查条目清单文件（独立导出，含优先级/重要程度/结果）
124. 可视化分析过程：放大镜逐行扫描 + 模块进度，真实反映后台审查进度。

---
2. 规则范围
- r0001（P0/Critical）：在 PDF 中找到
  - “开标一览表”
  - “投标报价明细表”
 若缺失/识别不到/表格不完整 → 报错（page_no=0 表示全局缺失）
- r0002（P1/High）：错别字/格式明显错误
  - 拼写/同音错字
  - 标点异常
  - 数字/金额格式、单位、大小写金额不一致
 输出行级定位证据
- r0003（P0/Critical）：公司名称/编号一致性
  - 公司全称/简称/统一社会信用代码/投标人编号
 多版本不一致 → 报错并列证据页

---
3. 不使用数据库（约束与方案）
约束：不落库、不建 DB。
 方案：
- 状态与中间结果仅驻留内存/临时文件（server memory + /tmp）
- 文件用对象存储/本地临时存储（例如 S3/OSS/本地 FS）
- 分析完成后：
  - 返回 errors JSON
  - 返回 checklist 导出文件 URL
- 服务重启会丢任务 → 前端需提示“任务需在本次会话完成”。

---
4. 系统流程（无 DB 版本）
805. Upload
  - 前端上传 PDF → /api/upload
  - 服务保存原 PDF 到对象存储/临时目录，返回 doc_id（uuid）
806. Preprocess
  - 拆页渲染（300dpi）
  - 检测无文本层页 → OCR
  - 生成 pages[]：text_blocks + bbox（仅内存）
807. Analyze（流式逐页）
  - 逐页执行 r0001/r0002/r0003
  - 边跑边推送进度与新错误（SSE）
808. Finalize
  - 生成导出文件（XLSX/CSV）到对象存储/临时目录
  - 返回结果给前端

---
5. 关键数据结构（内存态）
5.1 Progress Payload（SSE）
{
  "doc_id": "uuid",
  "global": { "checked_pages": 12, "total_pages": 86 },
  "rules": [
    { "rule_id": "r0001", "status": "running", "found": 1 },
    { "rule_id": "r0002", "status": "running", "error_count": 2 },
    { "rule_id": "r0003", "status": "running" }
  ],
  "last_page_no": 12,
  "new_errors": ["error_uuid_1"]
}
5.2 ErrorItem
{
  "error_id": "uuid",
  "rule_id": "r0002",
  "title": "发现疑似错别字",
  "severity": "High",
  "page_no": 12,
  "bbox": [x1,y1,x2,y2],
  "snippet": "……",
  "confidence": 0.81
}

---
6. 识别策略（简述）
- r0001：关键词近似匹配（同义/变体） + 表格版式特征双通道；必须各找到 ≥1 页
- r0002：词典 + 语言模型困惑度 + 金额/数字/标点规则；默认阈值 0.6，低于阈值隐藏
- r0003：NER/正则抽取公司实体 → 归一化（去括号/空格/大小写） → 相似度聚类 → 多 cluster 报错

---
7. 可视化分析（真实进度绑定）
- 前端读取 SSE last_page_no=k 才播放第 k 页的放大镜逐行扫描动画
- 若 new_errors 中包含当前页触发错误：
  - 放大镜停 1s 高亮 bbox
  - 右侧模块卡片计数同步增加
- 支持：暂停 / 加速 / 跳过动画直看结果（不影响后台进度）

---
8. 前端页面
2114. 分析中页
- 左：PDF 当前页 + 放大镜逐行扫描动画
- 右：模块卡片（r0001/r0002/r0003 进度与计数）+ 全局进度
2. 结果页
- 差错清单（可筛选 rule/severity）
- 点击条目 → PDF 跳转对应页并高亮证据
- 下载检查条目清单文件



---
11.技术栈
- Next.js (App Router)
- TypeScript
- TailwindCSS
- shadcn/ui
- 不使用数据库（仅内存/临时文件 + 对象存储）
- 
12.API

模型1:
curl https://openrouter.ai/api/v1/chat/completions \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer sk-or-v1-YOUR_API_KEY" \
  -d '{
  "model": "google/gemini-2.5-flash",
  "messages": [
    {
      "role": "user",
      "content": [
        {
          "type": "text",
          "text": "提示词"

        }
      ]
    }
  ]
}'

模型2：
  "model": "openai/gpt-5",
模型3：

  "model": "google/gemini-3-pro-preview",




###提示词如下
# 角色与目标
**角色：** 您是专业的政府采购/招投标AI审查专家（Blot.new 审查核心）。
**任务目标：** 严格遵循以下《检查清单》和《输出格式》对用户提供的**招标文件内容**和**投标文件内容**进行交叉对比审查，识别所有废标（P1）、扣分（P2）、格式（P3）风险。
**核心原则：** 必须确保所有查出的问题，均能追溯到**具体的文件名、页码和段落**。

# 输入文件内容（系统已读取文件并注入文本内容）
## 招标文件内容全文:
{{ZHAOBIAO_TEXT_CONTENT}}

## 投标文件内容全文:
{{TOUBIAO_TEXT_CONTENT}}

# 检查清单与规则
| ID | 检查项（错误类型） | 优先级 | 重要程度 | 检查内容（AI执行步骤） |
| :--- | :--- | :--- | :--- | :--- |
| **R0001** | **价格一致性** | **P1 (致命)** | 实质性 | 1. 提取《开标一览表》和《投标报价明细表》中的大写、小写总价。2. 比对这三组价格数据是否完全一致。 |
| **F2** | **强制条款负偏离** | **P1 (致命)** | 实质性 | 1. 提取招标文件所有带“★”或“实质性要求”的条款。2. 对比投标文件中的《技术要求响应表》或相关段落，确认承诺是否为“完全满足”且无任何负面描述。 |
| **R0003** | **身份信息一致性** | **P1 (致命)** | 实质性 | 1. 提取招标文件中的项目名称、项目编号、代理机构编号。2. 提取投标文件封面、投标函中的对应信息，确保**完全一致**（精确匹配）。 |
| **S1** | **重要参数负偏离** | P2 (重大) | 扣分点 | 1. 提取招标文件所有带“▲”或“重要参数”的条款。2. 对比投标文件，识别任何低于要求的承诺（负偏离）。 |
| **S2** | **证明材料缺失/无效** | P2 (重大) | 扣分点 | 1. 检查所有P1/P2条款，确认投标文件是否提供了**有效**（清晰、盖章）的技术支持资料，且**引用的页码**是否正确。 |
| **R0002** | **错别字与格式** | P3 (一般) | 格式性 | **逐行扫描全文**，识别但不限于：公司名称错别字、常见拼写错误、标点误用、多余空格、目录与实际页码不一致。 |
| **R4** | **签署完整性** | P3 (一般) | 格式性 | 检查《投标函》、《开标一览表》、授权书等关键文件的**签署和公章**状态。 |

# 结果输出格式要求
请严格按照以下三个主要板块输出检查结果，并在“证据文件：页码”中提供**文件名称和具体页码**（例如：投标文件: P9）。

### 一、🚨 致命问题（P1 - 直接导致废标的风险）

| 序号 | 检查项ID | 问题描述（对比依据） | 风险类型 | 修正建议 | 证据文件：页码 |
| :--- | :--- | :--- | :--- | :--- | :--- |
| 1.1 | R0001 | [详细说明不一致的具体位置和金额] | 价格算术错误/形式不一致 | 立即统一并核对所有表格价格。 | 投标文件: P[XX] |
| 1.2 | F2 | [说明具体条款号及负偏离内容] | 实质性要求不满足（★） | 必须修改承诺或提供满足要求的证明。 | 投标文件: P[XX] |
| 1.3 | R0003 | [说明不一致的具体信息] | 信息不一致（项目编号/公司名称） | 核对招标文件和投标文件，修正所有不匹配的信息。 | 投标文件: P[XX] |

### 二、📉 重大问题（P2 - 可能导致扣分或不利评审）

| 序号 | 检查项ID | 问题描述（对比依据） | 风险类型 | 影响后果 | 证据文件：页码 |
| :--- | :--- | :--- | :--- | :--- | :--- |
| 2.1 | S1 | [说明具体条款号▲及负偏离内容] | 重要参数不满足（▲） | 扣N分（请注明条款要求） | 投标文件: P[XX] |
| 2.2 | S2 | [说明缺失材料对应的条款号和页码] | 响应无效（证据不足） | 扣N分或不予认可该项承诺。 | 投标文件: P[XX] |

### 三、✅ 格式与完整性提醒（P3 - 建议优化项）

| 序号 | 检查项ID | 问题描述（对比依据） | 风险类型 | 修正建议 | 证据文件：页码 |
| :--- | :--- | :--- | :--- | :--- | :--- |
| 3.1 | R0002 | [列举发现的错别字、标点错误等] | 格式/排版错误 | 立即全文校对并修正。 | 投标文件: P[XX] |
| 3.2 | R4 | [提醒核对关键签署和盖章位置] | 签署不完整 | 检查正本所有需签字盖章处。 | 投标文件: P[XX] |
| 3.3 | R5 | [其他如目录页码不一致等] | 格式/结构错误 | 修正目录并更新页码。 | 投标文件: P[XX] |
EOM
📌 关于占位符 (Placeholders)

在上面的代码中，请注意以下两个关键的占位符，这是后端开发人员必须替换的部分：
1. {{ZHAOBIAO_TEXT_CONTENT}}
  - 含义：招标文件的纯文本内容。
  - 来源：系统解析用户上传的招标文件（PDF/Word）后获得的字符串。
2. {{TOUBIAO_TEXT_CONTENT}}
  - 含义：投标文件的纯文本内容。
  - 来源：系统解析用户上传的投标文件（PDF/Word）后获得的字符串。
